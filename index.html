<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒãƒ³ãƒ‡ã‚£ãƒƒãƒˆÃ—ãƒ™ã‚¤ã‚ºæˆ¦ç•¥</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-900">
  <div id="root" class="min-h-screen"></div>

  <script type="text/babel" data-type="module">
    const { useState, useEffect } = React;

    const load = (key, fallback) => {
      try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; } catch { return fallback; }
    };
    const save = (key, value) => localStorage.setItem(key, JSON.stringify(value));

    const zones = [
      { key: 'quick', label: 'ãŠã„ã—ã„å®Ÿé¨“', color: 'bg-emerald-100 text-emerald-700' },
      { key: 'big', label: 'å¤§å‹æ¡ˆä»¶', color: 'bg-blue-100 text-blue-700' },
      { key: 'maybe', label: 'å†è€ƒãŒå¿…è¦', color: 'bg-amber-100 text-amber-700' },
      { key: 'avoid', label: 'é¿ã‘ãŸã„', color: 'bg-rose-100 text-rose-700' },
    ];

    const zoneFor = (impact, cost) => {
      if (impact >= 4 && cost <= 3) return 'quick';
      if (impact >= 4 && cost >= 4) return 'big';
      if (impact <= 3 && cost <= 3) return 'maybe';
      return 'avoid';
    };

    const priorityScore = (impact, cost) => impact * (6 - cost);

    const SectionCard = ({ title, children, className = '' }) => (
      <section className={`bg-white rounded-2xl shadow-md border border-gray-200 p-5 ${className}`}>
        {title && <h2 className="text-xl font-bold mb-3">{title}</h2>}
        {children}
      </section>
    );

    const ScaleSelector = ({ label, subLabel, value, onChange }) => (
      <div className="font-semibold text-gray-800">
        <div className="flex items-baseline gap-2 mb-2">
          <span>{label}</span>
          {subLabel && <span className="text-xs text-gray-500">ï¼ˆ{subLabel}ï¼‰</span>}
        </div>
        <div className="bg-indigo-50 border border-indigo-100 rounded-2xl p-2">
          <div className="grid grid-cols-5 gap-2">
            {[1, 2, 3, 4, 5].map((n) => (
              <button
                key={n}
                type="button"
                onClick={() => onChange(n)}
                className={`relative h-12 rounded-xl transition focus:outline-none focus:ring-2 focus:ring-indigo-300 focus:ring-offset-1 focus:ring-offset-indigo-50 ${
                  value === n
                    ? 'bg-white shadow-sm border border-indigo-200'
                    : 'bg-indigo-50 hover:bg-white/80'
                }`}
              >
                <span className={`relative z-10 font-bold ${value === n ? 'text-indigo-600' : 'text-gray-700'}`}>{n}</span>
                {value === n && (
                  <span className="pointer-events-none absolute inset-1 rounded-lg border-2 border-indigo-200"></span>
                )}
              </button>
            ))}
          </div>
        </div>
      </div>
    );

    const IdeaForm = ({ onAdd }) => {
      const [title, setTitle] = useState('');
      const [note, setNote] = useState('');
      const [impact, setImpact] = useState(3);
      const [cost, setCost] = useState(3);

      const handleSubmit = (e) => {
        e.preventDefault();
        if (!title.trim()) return;
        onAdd({
          id: Date.now(),
          title: title.trim(),
          note,
          impact: Number(impact),
          cost: Number(cost),
          created: new Date().toISOString(),
        });
        setTitle('');
        setNote('');
        setImpact(3);
        setCost(3);
      };

      return (
        <SectionCard title="ã‚¢ã‚¤ãƒ‡ã‚¢å…¥åŠ›" className="mb-5">
          <form className="grid md:grid-cols-2 gap-4" onSubmit={handleSubmit}>
            <label className="font-semibold text-gray-800">
              ã‚¿ã‚¤ãƒˆãƒ«
              <input className="mt-1 w-full border rounded-lg p-3 bg-white text-gray-900" value={title} onChange={(e) => setTitle(e.target.value)} placeholder="ä¾‹: æ–°LPã§æ¤œè¨¼" required />
            </label>
            <label className="font-semibold text-gray-800">
              ãƒ¡ãƒ¢
              <textarea className="mt-1 w-full border rounded-lg p-3 bg-white text-gray-900" value={note} onChange={(e) => setNote(e.target.value)} placeholder="ä»®èª¬ã‚„èƒŒæ™¯ã‚’ãƒ¡ãƒ¢"></textarea>
            </label>
            <ScaleSelector label="ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ" subLabel="æœŸå¾…" value={impact} onChange={(n) => setImpact(n)} />
            <ScaleSelector label="ã‚³ã‚¹ãƒˆ" subLabel="å·¥æ•°" value={cost} onChange={(n) => setCost(n)} />
            <div className="md:col-span-2 flex justify-end">
              <button type="submit" className="px-4 py-3 rounded-lg bg-blue-600 text-white font-bold hover:bg-blue-700">è¿½åŠ ã™ã‚‹</button>
            </div>
          </form>
        </SectionCard>
      );
    };

    const ProjectTitle = ({ projectName, setProjectName }) => (
      <SectionCard className="mb-5">
        <div className="flex flex-col md:flex-row md:items-center gap-3">
          <div className="font-bold text-lg">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</div>
          <input className="flex-1 border rounded-lg p-3 bg-white text-gray-900" value={projectName} onChange={(e) => setProjectName(e.target.value)} placeholder="ä¾‹: 2024 Q4 æ–½ç­–" />
        </div>
      </SectionCard>
    );

    const Matrix = ({ ideas, projectName }) => {
      const matrixTitle = projectName?.trim() ? projectName : 'ãƒãƒˆãƒªã‚¯ã‚¹ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›...';
      const positionFor = (impact, cost) => ({
        left: `${((cost - 1) / 4) * 100}%`,
        top: `${((5 - impact) / 4) * 100}%`,
      });

      return (
        <SectionCard title="ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆÃ—ã‚³ã‚¹ãƒˆ ãƒãƒˆãƒªã‚¯ã‚¹" className="mb-5">
          <div className="relative w-full rounded-2xl border border-gray-200 bg-white overflow-hidden" style={{ minHeight: 420 }}>
            <div className="absolute inset-4 grid grid-cols-2 grid-rows-2 rounded-xl overflow-hidden">
              <div className="bg-emerald-50 border-r border-b border-white/60"></div>
              <div className="bg-blue-50 border-b border-white/60"></div>
              <div className="bg-amber-50 border-r border-white/60"></div>
              <div className="bg-gray-50"></div>
            </div>

            <div className="absolute inset-0 pointer-events-none">
              <div className="absolute top-3 left-1/2 transform -translate-x-1/2 text-gray-400 text-sm font-semibold">{matrixTitle}</div>
              <div className="absolute left-3 top-1/2 transform -translate-y-1/2 -rotate-90 origin-left text-gray-500 text-xs font-semibold tracking-wide">IMPACT (LOW â†’ HIGH)</div>
              <div className="absolute bottom-3 left-1/2 transform -translate-x-1/2 text-gray-500 text-xs font-semibold tracking-wide">COST (LOW â†’ HIGH)</div>
            </div>

            <div className="absolute inset-6">
              <div className="relative w-full h-full">
                {ideas.map(item => {
                  const pos = positionFor(item.impact, item.cost);
                  return (
                    <div
                      key={item.id}
                      className="absolute"
                      style={{ left: pos.left, top: pos.top, transform: 'translate(-50%, -50%)' }}
                    >
                      <div className="bg-white border border-gray-200 rounded-full px-3 py-1 text-xs font-semibold text-gray-800 shadow-sm whitespace-nowrap">
                        {item.title}
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        </SectionCard>
      );
    };

    const IdeaList = ({ ideas, onDelete, filter, setFilter }) => {
      const filtered = filter ? ideas.filter(i => zoneFor(i.impact, i.cost) === filter) : ideas;
      const sorted = [...filtered].sort((a, b) => priorityScore(b.impact, b.cost) - priorityScore(a.impact, a.cost));
      return (
        <SectionCard title="ã‚¹ã‚³ã‚¢é †ãƒªã‚¹ãƒˆ">
          <div className="flex flex-wrap gap-2 mb-3">
            <button className={`px-3 py-1 rounded-full border ${!filter ? 'bg-blue-600 text-white' : 'bg-white text-gray-800'}`} onClick={() => setFilter('')}>ã™ã¹ã¦</button>
            {zones.map(z => (
              <button key={z.key} className={`px-3 py-1 rounded-full border ${filter === z.key ? 'bg-blue-600 text-white' : 'bg-white text-gray-800'}`} onClick={() => setFilter(z.key)}>{z.label}</button>
            ))}
          </div>
          <div className="space-y-3">
            {sorted.map(item => (
              <div key={item.id} className="bg-gray-50 rounded-xl border border-gray-200 p-4 flex flex-col md:flex-row md:items-center gap-3">
                <div className="flex-1">
                  <div className="flex items-center gap-2 mb-1">
                    <span className="font-bold text-lg">{item.title}</span>
                    <span className={`text-xs font-bold px-2 py-1 rounded ${zones.find(z=>z.key===zoneFor(item.impact,item.cost))?.color || ''}`}>
                      {zones.find(z=>z.key===zoneFor(item.impact,item.cost))?.label}
                    </span>
                  </div>
                  <p className="text-sm text-gray-700 whitespace-pre-line">{item.note}</p>
                  <div className="text-xs text-gray-600 mt-1">ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ {item.impact} / ã‚³ã‚¹ãƒˆ {item.cost} / ã‚¹ã‚³ã‚¢ {priorityScore(item.impact, item.cost)}</div>
                </div>
                <button
                  className="self-start md:self-center px-4 py-2 rounded-lg bg-rose-100 text-rose-700 hover:bg-rose-200"
                  onClick={() => onDelete(item.id)}
                >
                  ğŸ—‘ å‰Šé™¤
                </button>
              </div>
            ))}
          </div>
        </SectionCard>
      );
    };

    const HypothesisBoard = ({ items, setItems }) => {
      const blank = { idea: '', hypothesis: '', platform: '', period: '', workload: 'å°', kpi: '', status: 'æœªç€æ‰‹', learning: '' };
      const [form, setForm] = useState(blank);
      const [statusFilter, setStatusFilter] = useState('ã™ã¹ã¦');
      const [platformFilter, setPlatformFilter] = useState('');

      const addItem = (e) => {
        e.preventDefault();
        if (!form.idea.trim()) return;
        const newItem = { ...form, id: Date.now() };
        setItems(prev => [...prev, newItem]);
        setForm(blank);
      };

      const updateItem = (id, patch) => setItems(prev => prev.map(i => i.id === id ? { ...i, ...patch } : i));
      const cycleStatus = (status) => status === 'æœªç€æ‰‹' ? 'å®Ÿè¡Œä¸­' : status === 'å®Ÿè¡Œä¸­' ? 'å®Œäº†' : 'æœªç€æ‰‹';

      const statusColor = (s) => {
        if (s === 'å®Œäº†') return 'bg-emerald-100 text-emerald-700';
        if (s === 'å®Ÿè¡Œä¸­') return 'bg-blue-100 text-blue-700';
        return 'bg-gray-100 text-gray-700';
      };

      const filteredItems = items.filter((item) => {
        const statusOk = statusFilter === 'ã™ã¹ã¦' || item.status === statusFilter;
        const platformOk = !platformFilter.trim() || (item.platform || '').toLowerCase().includes(platformFilter.trim().toLowerCase());
        return statusOk && platformOk;
      });

      return (
        <div className="space-y-4">
          <SectionCard className="space-y-4">
            <div className="flex flex-wrap items-center gap-2">
              <span className="text-xs font-bold px-3 py-1 rounded-full bg-indigo-100 text-indigo-700">Step 1</span>
              <h2 className="text-lg font-bold">ã‚¢ã‚¤ãƒ‡ã‚¢ã‹ã‚‰ä»®èª¬ã‚’ã¤ãã‚‹</h2>
              <span className="text-sm text-blue-700 font-semibold">ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆIf, thenå½¢å¼ï¼‰</span>
            </div>
            <p className="text-sm text-gray-600">ã€Œã‚¢ã‚¤ãƒ‡ã‚¢ã€ã‹ã‚‰ã€å®Ÿéš›ã«æ¤œè¨¼ã§ãã‚‹å°ã•ãªä»®èª¬ã«è½ã¨ã—è¾¼ã‚€ãŸã‚ã®ã‚·ãƒ¼ãƒˆã§ã™ã€‚</p>
            <div className="bg-indigo-50 border border-indigo-100 rounded-2xl p-4 space-y-3">
              <div className="text-xs text-indigo-800 font-semibold">ä¾‹ï¼‰AIã§â—¯â—¯ã®â—‹â—‹â–³â–³ã«ã¤ã„ã¦æ¤œè¨¼ã™ã‚‹</div>
              <div className="space-y-1 text-sm text-indigo-900">
                <div>ä¾‹ï¼‰ <strong className="font-semibold">If</strong> â—¯â—¯ã¨ã„ã†èª²é¡Œã«å¯¾ã—ã€ç§ãŸã¡ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã¯ã€‡ã€‡ã¨ã„ã†ä¾¡å€¤ã‚’å‡ºã›ã‚‹ã€‚</div>
                <div>ä¾‹ï¼‰ <strong className="font-semibold">Then</strong> AIã‚’ã¤ã‹ã£ãŸä»®èª¬æ¤œè¨¼ãƒ—ãƒ©ãƒ³ã§ã€åå¿œç‡ã‚’â—¯ï¼…æ”¹å–„ã§ãã‚‹ã€‚</div>
              </div>
              <ul className="list-disc list-inside text-xs text-indigo-900 space-y-1">
                <li>ãƒ»ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã®é«˜ãã†ãªã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ã‚’1ã¤é¸ã¶ï¼ˆ1ã¤ã«çµã‚‹ã“ã¨ï¼‰</li>
                <li>ãƒ»é¡§å®¢ã‚¤ãƒ³ã‚µã‚¤ãƒˆã®ä»®èª¬ã‚’ç«‹ã¦ã‚‹ï¼ˆã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ãŒæŠ±ãˆã‚‹èª²é¡Œï¼‰</li>
                <li>ãƒ»é¡§å®¢ã«ã¨ã£ã¦ã®ä¾¡å€¤ã‚’æ•´ç†ã™ã‚‹ï¼ˆèª²é¡Œã«å¯¾ã—ã¦ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãŒå‡ºã›ã‚‹ä¾¡å€¤ï¼‰</li>
              </ul>
            </div>
            <form className="space-y-3" onSubmit={addItem}>
              <div className="grid md:grid-cols-2 gap-3">
                <label className="font-semibold text-gray-800 text-sm">
                  ã‚¢ã‚¤ãƒ‡ã‚¢å
                  <input className="mt-1 w-full border rounded-lg p-3 bg-white text-gray-900" value={form.idea} onChange={(e)=>setForm({...form,idea:e.target.value})} placeholder="ä¾‹ï¼‰ AIã§â—¯â—¯ã®â—‹â—‹â–³â–³ã‚’æ¤œè¨¼" />
                </label>
                <label className="font-semibold text-gray-800 text-sm">
                  æ¤œè¨¼å¯èƒ½ãªä»®èª¬ï¼ˆIf, thenå½¢å¼ï¼‰
                  <textarea className="mt-1 w-full border rounded-lg p-3 bg-white text-gray-900" value={form.hypothesis} onChange={(e)=>setForm({...form,hypothesis:e.target.value})} placeholder="If ... , Then ... ã®å½¢ã§æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†" rows={3}></textarea>
                </label>
              </div>
              <div className="grid md:grid-cols-3 gap-3">
                <label className="font-semibold text-gray-800 text-sm">
                  ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 
                  <input className="mt-1 w-full border rounded-lg p-3 bg-white text-gray-900" value={form.platform} onChange={(e)=>setForm({...form,platform:e.target.value})} placeholder="ä¾‹ï¼‰X / Instagram" />
                </label>
                <label className="font-semibold text-gray-800 text-sm">
                  æœŸé–“
                  <input className="mt-1 w-full border rounded-lg p-3 bg-white text-gray-900" value={form.period} onChange={(e)=>setForm({...form,period:e.target.value})} placeholder="ä¾‹ï¼‰ä»Šé€±ä¸­" />
                </label>
                <label className="font-semibold text-gray-800 text-sm">
                  ä½œæ¥­é‡
                  <select className="mt-1 w-full border rounded-lg p-3 bg-white text-gray-900" value={form.workload} onChange={(e)=>setForm({...form,workload:e.target.value})}>
                    {['å°','ä¸­','å¤§'].map(opt => <option key={opt}>{opt}</option>)}
                  </select>
                </label>
              </div>
              <label className="font-semibold text-gray-800 text-sm block">
                KPI
                <input className="mt-1 w-full border rounded-lg p-3 bg-white text-gray-900" value={form.kpi} onChange={(e)=>setForm({...form,kpi:e.target.value})} placeholder="ä¾‹ï¼‰ãƒªãƒ¼ãƒ‰ç²å¾—æ•° 10ä»¶" />
              </label>
              <div className="flex justify-end">
                <button className="px-5 py-3 rounded-xl bg-blue-600 text-white font-bold hover:bg-blue-700">ã“ã®ä»®èª¬ã‚’ãƒªã‚¹ãƒˆã«ç™»éŒ²</button>
              </div>
            </form>
          </SectionCard>

          <SectionCard className="space-y-4">
            <div className="flex flex-wrap justify-between items-center gap-3">
              <div className="flex items-center gap-2">
                <span className="text-xs font-bold px-3 py-1 rounded-full bg-indigo-100 text-indigo-700">Step 2</span>
                <h2 className="text-lg font-bold">å°ã•ãè©¦ã™ä»®èª¬ãƒœãƒ¼ãƒ‰</h2>
              </div>
              <div className="flex flex-wrap gap-2 text-sm">
                <select className="border rounded-lg px-3 py-2 bg-white" value={statusFilter} onChange={(e)=>setStatusFilter(e.target.value)}>
                  {['ã™ã¹ã¦','æœªç€æ‰‹','å®Ÿè¡Œä¸­','å®Œäº†'].map(opt => <option key={opt}>{opt}</option>)}
                </select>
                <input className="border rounded-lg px-3 py-2 bg-white" placeholder="ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§çµã‚Šè¾¼ã¿" value={platformFilter} onChange={(e)=>setPlatformFilter(e.target.value)} />
              </div>
            </div>
            <p className="text-sm text-gray-600">ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã‚’è»¸ã«ã€Step1ã®ä»®èª¬ã«å¯¾ã—ã¦å°ã•ãå®Ÿé¨“ã§ãã‚‹ãƒœãƒ¼ãƒ‰ã€‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€æœªç€æ‰‹â†’å®Ÿè¡Œä¸­â†’å®Œäº†ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚</p>
            <div className="grid md:grid-cols-2 gap-3">
              {filteredItems.map(item => (
                <div key={item.id} className="rounded-2xl border border-indigo-100 bg-gradient-to-r from-white via-indigo-50 to-purple-50 shadow-sm p-4 space-y-3">
                  <div className="flex items-start justify-between gap-3">
                    <div className="flex flex-wrap items-center gap-2 text-xs font-semibold">
                      <button className={`px-3 py-1 rounded-full border ${statusColor(item.status)}`} onClick={()=>updateItem(item.id,{status:cycleStatus(item.status)})}>{item.status}</button>
                      {item.platform && <span className="px-2 py-1 rounded-full bg-white border text-indigo-700">{item.platform}</span>}
                      {item.period && <span className="px-2 py-1 rounded-full bg-white border text-gray-700">{item.period}</span>}
                    </div>
                    <div className="text-xs text-gray-600 flex items-center gap-2">
                      <span className="font-semibold text-indigo-700">ä½œæ¥­é‡</span>
                      <select className="border rounded px-2 py-1 bg-white" value={item.workload} onChange={(e)=>updateItem(item.id,{workload:e.target.value})}>
                        {['å°','ä¸­','å¤§'].map(opt => <option key={opt}>{opt}</option>)}
                      </select>
                    </div>
                  </div>
                  <input className="font-bold text-lg w-full border rounded-lg px-3 py-2 bg-white" value={item.idea} onChange={(e)=>updateItem(item.id,{idea:e.target.value})} />
                  <textarea className="w-full border rounded-lg px-3 py-2 bg-white text-sm" rows={3} value={item.hypothesis} onChange={(e)=>updateItem(item.id,{hypothesis:e.target.value})} placeholder="If..., Then..." />
                  <div className="grid grid-cols-2 gap-2 text-sm">
                    <input className="border rounded px-3 py-2 bg-white" value={item.platform} onChange={(e)=>updateItem(item.id,{platform:e.target.value})} placeholder="ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ " />
                    <input className="border rounded px-3 py-2 bg-white" value={item.period} onChange={(e)=>updateItem(item.id,{period:e.target.value})} placeholder="æœŸé–“" />
                    <input className="border rounded px-3 py-2 bg-white" value={item.kpi} onChange={(e)=>updateItem(item.id,{kpi:e.target.value})} placeholder="KPI" />
                    <div className="flex items-center text-xs text-gray-600 gap-2">
                      <span className="font-semibold text-indigo-700">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</span>
                      <span className={`px-2 py-1 rounded-full border ${statusColor(item.status)}`}>{item.status}</span>
                    </div>
                  </div>
                  {item.status === 'å®Œäº†' && (
                    <textarea className="w-full border rounded-lg px-3 py-2 bg-white text-sm" placeholder="å­¦ã³ãƒ¡ãƒ¢" value={item.learning || ''} onChange={(e)=>updateItem(item.id,{learning:e.target.value})} />
                  )}
                </div>
              ))}
              {filteredItems.length === 0 && (
                <div className="col-span-2 text-center text-sm text-gray-500 py-6 bg-white border border-dashed rounded-xl">ã¾ã ä»®èª¬ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚Step1ã§ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</div>
              )}
            </div>
          </SectionCard>
        </div>
      );
    };

    const defaultLabels = { reach: 'ãƒªãƒ¼ãƒ', response: 'åå¿œæ•°', revenue: 'å£²ä¸Š' };

    const ConfidenceBoard = ({ logs, setLogs, trackers, setTrackers, labels, setLabels }) => {
      const [entry, setEntry] = useState({ idea:'', model:'', reach:'', response:'', revenue:'', note:'' });
      const [detailOpen, setDetailOpen] = useState(null);
      const [modalOpen, setModalOpen] = useState(false);
      const [labelForm, setLabelForm] = useState(labels);
      const [logFilter, setLogFilter] = useState('all');

      const addLog = (e) => {
        e.preventDefault();
        if (!entry.idea.trim()) return;
        const newLog = { ...entry, id: Date.now(), created: new Date().toISOString(), success:'', failure:'', feedback:'' };
        setLogs(prev => [...prev, newLog]);
        setEntry({ idea:'', model:'', reach:'', response:'', revenue:'', note:'' });
        ensureTracker(entry.idea);
      };

      const updateLog = (id, patch) => setLogs(prev => prev.map(l => l.id === id ? { ...l, ...patch } : l));

      const ensureTracker = (idea) => {
        if (!idea.trim()) return;
        if (!trackers.find(t => t.idea === idea)) setTrackers(prev => [...prev, { idea, confidence:50, direction:'ãƒ—ãƒ©ã‚¹', reason:'' }]);
      };

      const updateTracker = (idea, patch) => setTrackers(prev => prev.map(t => t.idea === idea ? { ...t, ...patch } : t));

      const openModal = () => { setLabelForm(labels); setModalOpen(true); };
      const saveLabels = () => { setLabels(labelForm); setModalOpen(false); };

      const filteredLogs = logFilter === 'all' ? logs : logs.filter(l => l.idea === logFilter);
      const ideaOptions = Array.from(new Set(logs.map(l => l.idea).filter(Boolean)));

      useEffect(() => {
        logs.forEach(log => ensureTracker(log.idea || ''));
      }, [logs]);

      return (
        <div className="space-y-4">
          <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 space-y-5">
            <div className="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
              <div className="flex items-start gap-3">
                <span className="px-3 py-1 text-xs font-bold rounded-full bg-indigo-50 text-indigo-700">Step 1</span>
                <div>
                  <div className="text-lg font-bold">å®Ÿé¨“çµæœã‚’è¨˜éŒ²ã™ã‚‹</div>
                  <p className="text-sm text-gray-600">è¦³æ¸¬ã—ãŸçµæœã‚’å®šé‡ãƒ»å®šæ€§ã§æ®‹ã—ã¦ã€ã‚ã¨ã§å­¦ã³ã‚’æŠ½å‡ºã—ã‚„ã™ãã—ã¾ã™ã€‚</p>
                </div>
              </div>
              <button className="px-4 py-2 bg-gray-100 border rounded-lg text-sm font-semibold hover:bg-gray-200" onClick={openModal}>æŒ‡æ¨™ã‚’ç·¨é›†</button>
            </div>

            <form className="space-y-4" onSubmit={addLog}>
              <div className="grid md:grid-cols-2 gap-4">
                <label className="space-y-1 text-sm font-semibold text-gray-800">
                  <span>ã‚¢ã‚¤ãƒ‡ã‚¢</span>
                  <input className="w-full border rounded-xl p-3 bg-white text-gray-900" placeholder="ä¾‹ï¼šAI-PPCã®æ¤œçŸ¥Ã—ç«¶åˆãƒ¯ãƒ¼ãƒ‰æŠ½å‡º" value={entry.idea} onChange={(e)=>setEntry({...entry, idea:e.target.value})} />
                </label>
                <label className="space-y-1 text-sm font-semibold text-gray-800">
                  <span>ãƒ¢ãƒ‡ãƒ«/å¯¾è±¡</span>
                  <input className="w-full border rounded-xl p-3 bg-white text-gray-900" placeholder="ä¾‹ï¼šç²å¾—ç”¨è¨˜äº‹ãƒ•ã‚©ãƒˆ" value={entry.model} onChange={(e)=>setEntry({...entry, model:e.target.value})} />
                </label>
              </div>

              <div className="grid md:grid-cols-3 gap-3">
                <label className="space-y-1 text-sm font-semibold text-gray-800">
                  <span>{labels.reach}</span>
                  <input className="w-full border rounded-xl p-3 bg-white text-gray-900" placeholder="ä¾‹ï¼š0/50" value={entry.reach} onChange={(e)=>setEntry({...entry, reach:e.target.value})} />
                </label>
                <label className="space-y-1 text-sm font-semibold text-gray-800">
                  <span>{labels.response}</span>
                  <input className="w-full border rounded-xl p-3 bg-white text-gray-900" placeholder="ä¾‹ï¼š0/500" value={entry.response} onChange={(e)=>setEntry({...entry, response:e.target.value})} />
                </label>
                <label className="space-y-1 text-sm font-semibold text-gray-800">
                  <span>{labels.revenue}</span>
                  <input className="w-full border rounded-xl p-3 bg-white text-gray-900" placeholder="ä¾‹ï¼š0/1000" value={entry.revenue} onChange={(e)=>setEntry({...entry, revenue:e.target.value})} />
                </label>
              </div>

              <label className="space-y-1 text-sm font-semibold text-gray-800 block">
                <span>ãƒ¡ãƒ¢</span>
                <textarea className="w-full border rounded-xl p-3 bg-white text-gray-900" rows="3" placeholder="ä¾‹ï¼šãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ç¤¾æ•°ã¯1, DMã¯ã¾ã ãªã—" value={entry.note} onChange={(e)=>setEntry({...entry, note:e.target.value})}></textarea>
              </label>

              <div className="flex justify-center">
                <button className="px-5 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 w-full md:w-auto">ã“ã®å®Ÿé¨“çµæœã‚’è¿½åŠ </button>
              </div>
            </form>
          </div>

          <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 space-y-3">
            <div className="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
              <div className="flex items-start gap-3">
                <span className="px-3 py-1 text-xs font-bold rounded-full bg-indigo-50 text-indigo-700">Step 2</span>
                <div>
                  <div className="text-lg font-bold">ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å­¦ã³ã‚’æŠ½å‡ºã™ã‚‹</div>
                  <p className="text-sm text-gray-600">è¦³æ¸¬å€¤ã‚’è¦‹æ¯”ã¹ãªãŒã‚‰æˆåŠŸãƒ»å¤±æ•—è¦å› ã‚’æ•´ç†ã—ã¾ã™ã€‚</p>
                </div>
              </div>
              <div className="flex items-center gap-2">
                <label className="text-sm text-gray-600">ã‚¢ã‚¤ãƒ‡ã‚¢</label>
                <select className="border rounded-lg px-3 py-2 bg-white" value={logFilter} onChange={(e)=>setLogFilter(e.target.value)}>
                  <option value="all">ã™ã¹ã¦</option>
                  {ideaOptions.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                </select>
              </div>
            </div>

            <div className="space-y-3">
              {filteredLogs.length === 0 && (
                <div className="text-center text-sm text-gray-500 py-6 bg-gray-50 rounded-xl border border-dashed">å®Ÿé¨“çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>
              )}
              {filteredLogs.map(log => (
                <div key={log.id} className="rounded-2xl border border-gray-200 bg-white shadow-sm p-4 space-y-2">
                  <div className="flex justify-between items-start gap-3">
                    <div>
                      <div className="font-bold text-lg text-gray-900">{log.idea}</div>
                      <div className="text-xs text-gray-500">{new Date(log.created).toLocaleString('ja-JP')}</div>
                    </div>
                    <button className="text-blue-600 text-sm font-semibold" onClick={()=>setDetailOpen(detailOpen===log.id?null:log.id)}>{detailOpen===log.id?'é–‰ã˜ã‚‹':'è©³ç´°'}</button>
                  </div>
                  <div className="grid md:grid-cols-4 gap-2 text-sm text-gray-700">
                    <div className="flex flex-col"><span className="text-gray-500">ãƒ¢ãƒ‡ãƒ«/å¯¾è±¡</span><span className="font-semibold">{log.model || 'â€”'}</span></div>
                    <div className="flex flex-col"><span className="text-gray-500">{labels.reach}</span><span className="font-semibold">{log.reach}</span></div>
                    <div className="flex flex-col"><span className="text-gray-500">{labels.response}</span><span className="font-semibold">{log.response}</span></div>
                    <div className="flex flex-col"><span className="text-gray-500">{labels.revenue}</span><span className="font-semibold">{log.revenue}</span></div>
                  </div>
                  {log.note && <div className="text-sm text-gray-700 bg-indigo-50/60 border border-indigo-100 rounded-xl p-3">{log.note}</div>}
                  {detailOpen === log.id && (
                    <div className="grid md:grid-cols-3 gap-3 text-sm">
                      <textarea className="border rounded-lg px-3 py-2 bg-white" placeholder="æˆåŠŸè¦å› " value={log.success || ''} onChange={(e)=>updateLog(log.id,{success:e.target.value})} />
                      <textarea className="border rounded-lg px-3 py-2 bg-white" placeholder="å¤±æ•—è¦å› " value={log.failure || ''} onChange={(e)=>updateLog(log.id,{failure:e.target.value})} />
                      <textarea className="border rounded-lg px-3 py-2 bg-white" placeholder="å®šæ€§ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯" value={log.feedback || ''} onChange={(e)=>updateLog(log.id,{feedback:e.target.value})} />
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>

          <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 space-y-4">
            <div className="flex items-start gap-3">
              <span className="px-3 py-1 text-xs font-bold rounded-full bg-indigo-50 text-indigo-700">Step 3</span>
              <div>
                <div className="text-lg font-bold">ä»®èª¬ã®è‡ªä¿¡åº¦ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹</div>
                <p className="text-sm text-gray-600">å®Ÿé¨“çµæœã‚’è¸ã¾ãˆã€ãƒ—ãƒ©ã‚¹/ãƒã‚¤ãƒŠã‚¹ã®è©•ä¾¡ã¨ç†ç”±ã‚’æ·»ãˆã¦è‡ªä¿¡åº¦ã‚’æ›´æ–°ã—ã¾ã™ã€‚</p>
              </div>
            </div>

            {trackers.length === 0 && (
              <div className="text-sm text-gray-500 bg-gray-50 border border-dashed rounded-xl p-5">å®Ÿé¨“çµæœã‚’è¿½åŠ ã™ã‚‹ã¨ã€ã“ã“ã«è‡ªä¿¡åº¦ãƒˆãƒ©ãƒƒã‚«ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
            )}

            <div className="grid gap-3 md:grid-cols-2">
              {trackers.map(t => (
                <div key={t.idea} className="border border-gray-200 rounded-2xl p-4 bg-white shadow-sm space-y-2">
                  <div className="font-bold text-gray-900">{t.idea}</div>
                  <input type="range" min="0" max="100" value={t.confidence} className="w-full" onChange={(e)=>updateTracker(t.idea,{confidence:Number(e.target.value)})} />
                  <div className="flex items-center justify-between text-sm text-gray-700">
                    <span className="font-semibold">è‡ªä¿¡åº¦: {t.confidence}%</span>
                    <select className="border rounded-lg px-3 py-2 bg-white" value={t.direction} onChange={(e)=>updateTracker(t.idea,{direction:e.target.value})}>
                      <option>ãƒ—ãƒ©ã‚¹</option>
                      <option>ãƒã‚¤ãƒŠã‚¹</option>
                    </select>
                  </div>
                  <textarea className="w-full border rounded-lg px-3 py-2 bg-white" placeholder="æ›´æ–°ç†ç”±" value={t.reason || ''} onChange={(e)=>updateTracker(t.idea,{reason:e.target.value})} />
                </div>
              ))}
            </div>
          </div>

          {modalOpen && (
            <div className="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center p-4">
              <div className="bg-white rounded-2xl p-5 w-full max-w-md shadow-xl space-y-3">
                <div className="text-lg font-bold">æŒ‡æ¨™ãƒ©ãƒ™ãƒ«ã‚’ç·¨é›†</div>
                {['reach','response','revenue'].map(key => (
                  <label key={key} className="font-semibold text-gray-800">
                    {labels[key]}
                    <input className="mt-1 w-full border rounded-lg p-3 bg-white text-gray-900" value={labelForm[key]} onChange={(e)=>setLabelForm({...labelForm,[key]:e.target.value})} />
                  </label>
                ))}
                <div className="flex justify-end gap-2">
                  <button className="px-4 py-2 rounded-lg border" onClick={()=>setModalOpen(false)}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                  <button className="px-4 py-2 rounded-lg bg-blue-600 text-white" onClick={saveLabels}>ä¿å­˜</button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    const App = () => {
      const [activeTab, setActiveTab] = useState('matrix');
      const [ideas, setIdeas] = useState(() => load('ideas', []));
      const [filter, setFilter] = useState('');
      const [projectName, setProjectName] = useState(() => load('projectName', ''));
      const [hypotheses, setHypotheses] = useState(() => load('hypotheses', []));
      const [logs, setLogs] = useState(() => load('logs', []));
      const [trackers, setTrackers] = useState(() => load('trackers', []));
      const [labels, setLabels] = useState(() => load('labels', defaultLabels));

      useEffect(() => save('ideas', ideas), [ideas]);
      useEffect(() => save('projectName', projectName), [projectName]);
      useEffect(() => save('hypotheses', hypotheses), [hypotheses]);
      useEffect(() => save('logs', logs), [logs]);
      useEffect(() => save('trackers', trackers), [trackers]);
      useEffect(() => save('labels', labels), [labels]);

      const addIdea = (idea) => setIdeas(prev => [...prev, idea]);
      const deleteIdea = (id) => setIdeas(prev => prev.filter(i => i.id !== id));

      return (
        <div className="max-w-6xl mx-auto px-4 py-6">
          <header className="mb-6">
            <h1 className="text-3xl font-extrabold">ãƒãƒ³ãƒ‡ã‚£ãƒƒãƒˆÃ—ãƒ™ã‚¤ã‚ºæˆ¦ç•¥</h1>
            <p className="text-gray-600">Impact Ã— Cost ã§ä»•åˆ†ã‘ã—ã€ä»®èª¬æ¤œè¨¼ã¨ãƒ™ã‚¤ã‚ºæ›´æ–°ã¾ã§ã‚’ä¸€æ°—é€šè²«ã§ç®¡ç†ã€‚</p>
          </header>

          <div className="grid grid-cols-3 gap-2 mb-5">
            <button className={`py-3 rounded-xl font-bold ${activeTab==='matrix' ? 'bg-blue-600 text-white' : 'bg-white border'}`} onClick={()=>setActiveTab('matrix')}>ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆÃ—ã‚³ã‚¹ãƒˆ</button>
            <button className={`py-3 rounded-xl font-bold ${activeTab==='hypo' ? 'bg-blue-600 text-white' : 'bg-white border'}`} onClick={()=>setActiveTab('hypo')}>ä»®èª¬æ¤œè¨¼ãƒœãƒ¼ãƒ‰</button>
            <button className={`py-3 rounded-xl font-bold ${activeTab==='confidence' ? 'bg-blue-600 text-white' : 'bg-white border'}`} onClick={()=>setActiveTab('confidence')}>è‡ªä¿¡åº¦åˆ†æãƒœãƒ¼ãƒ‰</button>
          </div>

          {activeTab === 'matrix' && (
            <div className="space-y-2">
              <IdeaForm onAdd={addIdea} />
              <ProjectTitle projectName={projectName} setProjectName={setProjectName} />
              <Matrix ideas={ideas} projectName={projectName} />
              <IdeaList ideas={ideas} onDelete={deleteIdea} filter={filter} setFilter={setFilter} />
            </div>
          )}

          {activeTab === 'hypo' && (
            <HypothesisBoard items={hypotheses} setItems={setHypotheses} />
          )}

          {activeTab === 'confidence' && (
            <ConfidenceBoard logs={logs} setLogs={setLogs} trackers={trackers} setTrackers={setTrackers} labels={labels} setLabels={setLabels} />
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
